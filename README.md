# Prelude

**The open standard for machine-readable codebase context.**

Prelude transforms your codebase into structured, AI-optimized context that makes working with LLMs 10x more effective.

[![npm version](https://badge.fury.io/js/prelude-context.svg)](https://www.npmjs.com/package/prelude-context)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## Why Prelude?

Every time you start a new conversation with an AI assistant, you're forced to explain:
- What stack you're using
- How your codebase is organized  
- What patterns and constraints you follow
- What decisions have been made

**Prelude solves this.**

Instead of repeating yourself, run `prelude export` and get a comprehensive, AI-optimized context document that captures:

- âœ… Your technology stack
- âœ… Project architecture and patterns
- âœ… Development constraints and preferences
- âœ… Key decisions and their rationale
- âœ… Recent changes and work sessions

## Quick Start

```bash
# Install globally
npm install -g prelude-context

# Initialize in your project
cd your-project
prelude init

# Generate AI-optimized context
prelude export
```

The export is automatically copied to your clipboard - just paste it into Claude, ChatGPT, or any LLM!

---

## Example Output

Here's what Prelude generates for a Next.js monorepo:

```markdown
# Project Context
> Generated by Prelude

## ğŸ“‹ Project Overview
**Name:** lucem-monorepo
**Description:** Universal operating system for verified work
**Version:** 1.0.0

## ğŸ”§ Technology Stack
**Language:** TypeScript/JavaScript
**Runtime:** Node.js >=18.0.0
**Package Manager:** pnpm
**Frameworks:** Next.js, React
**Database:** Supabase, PostgreSQL
**ORM:** Drizzle ORM

## ğŸ—ï¸ Architecture
**Type:** monorepo
**Patterns:** Component-based architecture, Server Components
**Key Directories:**
- apps/web - Next.js application
- packages/db - Database schemas and migrations

## âš ï¸ Constraints & Preferences
**Must Use:**
- Turborepo for monorepo management
- TypeScript strict mode
- Server Components by default
```

[See full example â†’](./examples/nextjs-monorepo)

---

## What Makes Prelude Different?

| Feature | Prelude | Manual Context | Other Tools |
|---------|---------|----------------|-------------|
| Automatic inference | âœ… | âŒ | âš ï¸ |
| Standards-based | âœ… | âŒ | âŒ |
| Human-readable | âœ… | âœ… | âŒ |
| Machine-optimized | âœ… | âŒ | âœ… |
| Version controlled | âœ… | âš ï¸ | âŒ |
| Zero configuration | âœ… | N/A | âŒ |
| Preserves manual edits | âœ… | âœ… | âŒ |

---

## Core Commands

### `prelude init`
Analyzes your codebase and creates a `.context/` directory with:
- `project.json` - Project metadata
- `stack.json` - Technology stack
- `architecture.json` - Architecture patterns and structure
- `constraints.json` - Development rules and preferences
- `decisions.json` - Architecture decision records
- `changelog.md` - Project timeline

All files follow the [Prelude specification](./SPEC.md) and include JSON Schema validation.

### `prelude export`
Generates a markdown document optimized for LLMs:
- Combines all context into a single, focused document
- Automatically copied to clipboard
- Perfect for starting new AI conversations

### `prelude update`
Re-analyzes your codebase and intelligently updates context:
```bash
prelude update
# Smart merge - preserves manual edits, updates inferred data

prelude update --dry-run
# Preview changes without applying them

prelude update --force
# Overwrite everything (except decisions/changelog)
```

**Key features:**
- âœ… **Preserves manual edits** - Never loses your customizations
- âœ… **Shows what changed** - Color-coded diff of updates
- âœ… **Automatic backups** - Saves history before every update
- âœ… **Smart merging** - Combines new inferred data with manual edits

### `prelude decision <title>`
Logs architecture decisions:
```bash
prelude decision "Use Drizzle ORM instead of Prisma"
# Opens editor for you to document the decision and rationale
```

### `prelude watch`
Tracks development sessions:
```bash
prelude watch
# Monitors file changes and logs your work session
# Press Ctrl+C when done to save the session
```

---

## Use Cases

### ğŸ¯ Starting New Conversations
Paste your Prelude export to instantly give any LLM full context:

```
Here's my project context:

[paste prelude export]

I want to add user authentication. What's the best approach given our stack?
```

### ğŸ› Debugging
```
Here's my project context:

[paste prelude export]

I'm seeing this error: [error]
In file: apps/web/app/api/route.ts

What's likely causing this?
```

### ğŸ—ï¸ Architecture Decisions
```
Here's my project context:

[paste prelude export]

Should I use Server Actions or API routes for [feature]?
Consider our existing patterns and constraints.
```

### ğŸ“š Onboarding
Share your `.context/` directory with new team members so they can:
- Understand the stack instantly
- Learn architectural patterns
- See past decisions and rationale

### ğŸ”„ Keeping Context Fresh
```bash
# After adding dependencies
npm install @tanstack/react-query
prelude update

# After restructuring
prelude update --dry-run  # Preview changes first
prelude update            # Apply updates
```

---

## The Prelude Format

Prelude is an **open standard** - not just a CLI tool. The format is:
- **Versioned** - Semantic versioning for safe evolution
- **Validated** - JSON Schema for every file type
- **Extensible** - Add custom fields as needed
- **Language-agnostic** - Implement in any language

See the [full specification â†’](./SPEC.md)

All schemas are hosted at: `https://adjective.us/prelude/schemas/v1/`

---

## Advanced Usage

### Manual Edits
The `.context/` files are human-readable JSON. Edit them directly:

```json
{
  "$schema": "https://adjective.us/prelude/schemas/v1/constraints.json",
  "version": "1.0.0",
  "mustUse": [
    "TypeScript strict mode",
    "Server Components by default"
  ],
  "preferences": [
    {
      "category": "state-management",
      "preference": "Prefer URL state over client state",
      "rationale": "Improves sharability and reduces bugs"
    }
  ]
}
```

**Manual edits are preserved** when you run `prelude update` - the smart merge system tracks what's inferred vs. what you've customized.

### Custom Fields
Add project-specific fields - the schemas allow additional properties:

```json
{
  "$schema": "https://adjective.us/prelude/schemas/v1/project.json",
  "version": "1.0.0",
  "name": "my-app",
  "customField": "your data",
  "team": [
    { "name": "Alice", "role": "Tech Lead" }
  ]
}
```

### Integration
Use Prelude in your tools:

```typescript
import { readFileSync } from 'fs';
import { join } from 'path';

// Read project context
const project = JSON.parse(
  readFileSync(join(process.cwd(), '.context/project.json'), 'utf-8')
);

console.log(`Project: ${project.name}`);
console.log(`Stack: ${project.stack?.language}`);
```

---

## Requirements

- Node.js >= 18.0.0
- Git (optional, for tracking changes)

---

## Project Structure

```
your-project/
â”œâ”€â”€ .context/              # Created by Prelude
â”‚   â”œâ”€â”€ project.json      # Project metadata
â”‚   â”œâ”€â”€ stack.json        # Technology stack  
â”‚   â”œâ”€â”€ architecture.json # Architecture patterns
â”‚   â”œâ”€â”€ constraints.json  # Development rules
â”‚   â”œâ”€â”€ decisions.json    # Architecture decisions
â”‚   â”œâ”€â”€ changelog.md      # Project timeline
â”‚   â””â”€â”€ .prelude/         # State tracking (gitignore *.session.json)
â”‚       â”œâ”€â”€ state.json    # Tracks inferred vs manual fields
â”‚       â””â”€â”€ history/      # Automatic backups
â”œâ”€â”€ .gitignore            # Add .context/*.session.json
â””â”€â”€ ...
```

**Note:** Commit `.context/` to version control (except `*.session.json` files).

---

## FAQ

### Should I commit `.context/` to git?
**Yes!** The context is part of your project documentation. Exception: `.context/*.session.json` should be gitignored (it's for local work tracking).

### How often should I update the context?
Run `prelude update` after major changes (new dependencies, restructuring). Run `prelude export` whenever you need fresh context for an AI conversation.

### What happens to my manual edits?
They're preserved! Prelude tracks which fields are inferred vs. manually edited. When you run `update`, it only changes auto-detected data while keeping your customizations.

### Can I use this with any LLM?
Yes! The export format is optimized for Claude, ChatGPT, Gemini, and any text-based AI assistant.

### What if my project structure is unusual?
Prelude's inference is smart but not perfect. Just edit the `.context/` files directly - they're human-readable JSON.

### Does this work with non-JavaScript projects?
Yes! While the CLI is built with Node.js, the Prelude format works with any language. The inference currently focuses on JavaScript/TypeScript but the format is universal.

---

## Roadmap

- [x] Smart context updates with manual edit preservation
- [ ] Improved inference for Python, Rust, Go
- [ ] VS Code extension for inline context
- [ ] GitHub Action for automated updates
- [ ] Plugin system for custom inference
- [ ] CLI validation command
- [ ] Context diff tool

Want to contribute? See [CONTRIBUTING.md](./CONTRIBUTING.md)

---

## Design Principles

1. **Human-readable first** - All files are readable JSON/Markdown
2. **AI-optimized** - Structured for maximum LLM effectiveness  
3. **Standards-based** - Open spec, not proprietary format
4. **Zero lock-in** - Edit files manually, use any tool
5. **Incremental adoption** - Works with partial information
6. **Preserve intent** - Never lose manual customizations

---

## Examples

- [Next.js Monorepo](./examples/nextjs-monorepo) - Turborepo + Drizzle + Supabase
- [Express API](./examples/express-api) - REST API with PostgreSQL
- [Vite React App](./examples/vite-react) - Frontend SPA

---

## Contributing

Contributions are welcome! Please read [CONTRIBUTING.md](./CONTRIBUTING.md) first.

Areas we'd love help with:
- Improved inference patterns
- Support for more languages/frameworks  
- Example projects
- Documentation improvements
- Bug reports and feature requests

---

## License

MIT Â© [Adjective](https://adjective.us)

---

## Links

- [Specification](./SPEC.md)
- [Schema Documentation](./schemas/README.md)
- [Examples](./examples/)
- [NPM Package](https://www.npmjs.com/package/prelude-context)
- [Issues & Feature Requests](https://github.com/adjective-rob/prelude/issues)

---

**Built by [Adjective](https://adjective.us) - Sovereign Software for AI-Native Teams**